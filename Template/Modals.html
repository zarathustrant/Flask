<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet Map with Modals</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gridstack.js/4.3.1/gridstack.min.css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- Modal for adding text widgets -->
    <div class="modal fade" id="addTextWidgetModal" tabindex="-1" role="dialog" aria-labelledby="addTextWidgetModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addTextWidgetModalLabel">Add Text Widget</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="addTextWidgetForm">
                        <div class="form-group">
                            <label for="textWidgetHTML">HTML Content</label>
                            <textarea class="form-control" id="textWidgetHTML" name="textWidgetHTML" rows="4" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="textWidgetCSS">CSS Styles</label>
                            <textarea class="form-control" id="textWidgetCSS" name="textWidgetCSS" rows="4"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="textWidgetJS">JavaScript</label>
                            <textarea class="form-control" id="textWidgetJS" name="textWidgetJS" rows="4"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Widget</button>
                    </form>
                </div>
            </div>
        </div>
    </div>   

    <!-- Modal for Shapefile Conversion -->
    <div class="modal fade" id="shapefileConverterModal" tabindex="-1" role="dialog" aria-labelledby="shapefileConverterModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="shapefileConverterModalLabel">Shapefile to KML and GeoJSON Converter</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="shapefileConverterForm" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="shapefileInput">Select Zipped Shapefile</label>
                            <input type="file" class="form-control-file" id="shapefileInput" name="shapefileInput" accept=".zip" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Convert</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal for uploading GeoJSON -->
    <div class="modal fade" id="addDataModal" tabindex="-1" role="dialog" aria-labelledby="addDataModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addDataModalLabel">Upload GeoJSON File</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="uploadGeojsonForm" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="fileInput">Select GeoJSON File</label>
                            <input type="file" class="form-control-file" id="fileInput" name="fileInput" accept=".geojson" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Upload</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for SRTM Data Generation -->
    <div class="modal fade" id="generateSrtmDataModal" tabindex="-1" role="dialog" aria-labelledby="generateSrtmDataModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="generateSrtmDataModalLabel">Generate SRTM Data</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="generateSrtmDataForm">
                        <div class="form-group">
                            <label for="centerLat">Center Latitude</label>
                            <input type="text" class="form-control" id="centerLat" name="center_lat" required>
                        </div>
                        <div class="form-group">
                            <label for="centerLon">Center Longitude</label>
                            <input type="text" class="form-control" id="centerLon" name="center_lon" required>
                        </div>
                        <div class="form-group">
                            <label for="sideLengthKm">Side Length (km)</label>
                            <input type="text" class="form-control" id="sideLengthKm" name="side_length_km" required>
                        </div>
                        <div class="form-group">
                            <label for="numPoints">Number of Grid Points</label>
                            <input type="text" class="form-control" id="numPoints" name="num_points" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Generate</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for KML to GeoJSON Conversion -->
    <div class="modal fade" id="convertKmlModal" tabindex="-1" role="dialog" aria-labelledby="convertKmlModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="convertKmlModalLabel">Convert KML to GeoJSON</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="convertKmlForm" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="kmlFileInput">Select KML File</label>
                            <input type="file" class="form-control-file" id="kmlFileInput" name="kmlFileInput" accept=".kml" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Convert</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Coordinate Conversion -->
    <div class="modal fade" id="convertCoordinatesModal" tabindex="-1" role="dialog" aria-labelledby="convertCoordinatesModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="convertCoordinatesModalLabel">Convert Coordinates</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="convertCoordinatesForm" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="csvFileInput">Select CSV File</label>
                            <input type="file" class="form-control-file" id="csvFileInput" name="csvFileInput" accept=".csv" required>
                        </div>
                        <div class="form-group">
                            <label for="xColumn">X Column</label>
                            <select class="form-control" id="xColumn" name="xColumn"></select>
                        </div>
                        <div class="form-group">
                            <label for="yColumn">Y Column</label>
                            <select class="form-control" id="yColumn" name="yColumn"></select>
                        </div>
                        <div class="form-group">
                            <label for="input_wkt">Input CRS WKT</label>
                            <textarea class="form-control" id="input_wkt" name="input_wkt" rows="4" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="output_wkt">Output CRS WKT</label>
                            <textarea class="form-control" id="output_wkt" name="output_wkt" rows="4" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Convert</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for COGO -->
    <div class="modal fade" id="cogoModal" tabindex="-1" role="dialog" aria-labelledby="cogoModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="cogoModalLabel">Coordinate Geometry (COGO)</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="cogoForm">
                        <div class="form-group">
                            <label for="projection">Projection</label>
                            <select class="form-control" id="projection" name="projection">
                                <option value="epsg:26331">UTM Zone 31N (Minna)</option>
                                <option value="epsg:26332">UTM Zone 32N (Minna)</option>
                                <option value="epsg:26333">UTM Zone 33N (Minna)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="startEasting">Starting Easting (m)</label>
                            <input type="text" class="form-control" id="startEasting" name="startEasting" required>
                        </div>
                        <div class="form-group">
                            <label for="startNorthing">Starting Northing (m)</label>
                            <input type="text" class="form-control" id="startNorthing" name="startNorthing" required>
                        </div>
                        <button type="button" class="btn btn-primary" id="addVertexBtn">Add Vertex</button>
                        <button type="button" class="btn btn-secondary" id="saveToCsvBtn">Save to CSV</button>
                    </form>
                    <ul id="vertexList" class="list-group mt-3"></ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Create Polygons from Points -->
    <div class="modal fade" id="createPolygonsModal" tabindex="-1" role="dialog" aria-labelledby="createPolygonsModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createPolygonsModalLabel">Create Polygons from Points</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="createPolygonsForm" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="polygonCsvFileInput">Select CSV File</label>
                            <input type="file" class="form-control-file" id="polygonCsvFileInput" name="csvFileInput" accept=".csv" required>
                        </div>
                        <div class="form-group">
                            <label for="longitudeColumn">Longitude Column</label>
                            <select class="form-control" id="longitudeColumn" name="longitudeColumn"></select>
                        </div>
                        <div class="form-group">
                            <label for="latitudeColumn">Latitude Column</label>
                            <select class="form-control" id="latitudeColumn" name="latitudeColumn"></select>
                        </div>
                        <div class="form-group">
                            <label for="snColumn">S/N Column</label>
                            <select class="form-control" id="snColumn" name="snColumn"></select>
                        </div>
                        <button type="submit" class="btn btn-primary">Create Polygons</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Attribute Table -->
    <div class="modal fade" id="attributeTableModal" tabindex="-1" role="dialog" aria-labelledby="attributeTableModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="attributeTableModalLabel">Attribute Table</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Attribute table content will be injected here -->
                </div>
            </div>
        </div>
    </div>

        <!-- Modal for Editing Layer -->
    <div class="modal fade" id="editLayerModal" tabindex="-1" role="dialog" aria-labelledby="editLayerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editLayerModalLabel">Edit Layer</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form id="editLayerForm">
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="symbologyType">Symbology Type</label>
                            <select id="symbologyType" class="form-control">
                                <option value="single">Single Symbol</option>
                                <option value="categorized">Categorized</option>
                            </select>
                        </div>

                        <!-- Single Symbol Settings -->
                        <div id="singleSymbolSettings">
                            <div class="form-group">
                                <label for="colorInput">Color</label>
                                <input type="color" id="colorInput" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="weightInput">Weight</label>
                                <input type="number" id="weightInput" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="opacityInput">Opacity</label>
                                <input type="range" id="opacityInput" class="form-control" min="0" max="1" step="0.1">
                            </div>
                            <div class="form-group">
                                <label for="fillColorInput">Fill Color</label>
                                <input type="color" id="fillColorInput" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="fillOpacityInput">Fill Opacity</label>
                                <input type="range" id="fillOpacityInput" class="form-control" min="0" max="1" step="0.1">
                            </div>
                        </div>

                        <!-- Categorized Symbol Settings -->
                        <div id="categorizedSymbolSettings" class="d-none">
                            <div class="form-group">
                                <label for="categoryField">Category Field</label>
                                <select id="categoryField" class="form-control"></select>
                            </div>
                            <div id="categoryValues"></div>
                            <button type="button" class="btn btn-secondary mt-2" id="addCategoryValue">Add Categories</button>
                        </div>

                        <!-- Labeling Settings -->
                        <h6 class="mt-4">Labeling</h6>
                        <div class="form-group">
                            <label for="labelField">Label Field</label>
                            <select id="labelField" class="form-control"></select>
                        </div>
                        <div class="form-group">
                            <label for="labelExpression">Label Expression</label>
                            <input type="text" id="labelExpression" class="form-control" placeholder="{FieldName}">
                        </div>
                        <div class="form-group">
                            <label for="labelFontSize">Font Size</label>
                            <input type="text" id="labelFontSize" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="labelFontFamily">Font Family</label>
                            <input type="text" id="labelFontFamily" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="labelColor">Label Color</label>
                            <input type="color" id="labelColor" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="labelOpacity">Label Opacity</label>
                            <input type="range" id="labelOpacity" class="form-control" min="0" max="1" step="0.1">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
        <!-- Modal for Settings -->
    <div class="modal fade" id="settingsModal" tabindex="-1" role="dialog" aria-labelledby="settingsModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="settingsModalLabel">Settings</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="settingsForm">
                        <div class="form-group">
                            <label for="defaultLat">Default Latitude</label>
                            <input type="text" class="form-control" id="defaultLat" name="defaultLat" required>
                        </div>
                        <div class="form-group">
                            <label for="defaultLng">Default Longitude</label>
                            <input type="text" class="form-control" id="defaultLng" name="defaultLng" required>
                        </div>
                        <div class="form-group">
                            <label for="defaultZoom">Default Zoom Level</label>
                            <input type="number" class="form-control" id="defaultZoom" name="defaultZoom" required min="0" max="19">
                        </div>
                        <button type="submit" class="btn btn-primary">Save Settings</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gridstack.js/4.3.1/gridstack-h5.js"></script>
    <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
